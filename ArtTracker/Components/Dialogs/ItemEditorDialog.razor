@namespace TinyLeadsBank.Components.Pages.Dialogs
@using ArtTracker.Data.Trophies
@inject TrophyService trophyService
@inject IDialogService dialogService

<MudDialog>
    <DialogContent>
        <MudTextField @bind-Value="Item.ItemName" Label="Name" />
        <MudTextField @bind-Value="Item.ItemDescription" Lines="3" Label="Description/Notes" />
        <MudSelect @bind-Value="SelectedCategory" Label="Category">
            @foreach (Category category in Categories.OrderBy(e => e.OrderNumber))
            {
                <MudSelectItem Value="@category"><MudText Color="category.CategoryColor">@category.CategoryName</MudText></MudSelectItem>
            }
        </MudSelect>
        <MudSelect @bind-Value="Item.EstEffort" Label="Estimated Effort" Clearable T="int?">
            <MudSelectItem T="int?" Value="null">Unknown</MudSelectItem>
            <MudSelectItem T="int?" Value="1">Small</MudSelectItem>
            <MudSelectItem T="int?" Value="2">Medium</MudSelectItem>
            <MudSelectItem T="int?" Value="3">Large</MudSelectItem>
            <MudSelectItem T="int?" Value="4">Epic</MudSelectItem>
        </MudSelect>
        @if (Item.CategoryID != Guid.Empty && Item.Efforts.Count > 0)
        {
            <MudCheckBox @bind-Value="Item.Completed">Completed</MudCheckBox>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Filled" Color="Color.Default">Cancel</MudButton>
        <MudButton OnClick="Submit" Variant="Variant.Filled" Color="Color.Info" Disabled="string.IsNullOrWhiteSpace(Item.ItemName) || SelectedCategory == null">Save</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public Item Item { get; set; } = new();
    [Parameter] public List<Category> Categories { get; set; } = [];
    private Category? SelectedCategory { get; set; }
    protected override void OnInitialized()
    {
        if (Item.CategoryID != null)
        {
            SelectedCategory = Categories.FirstOrDefault(e => e.ID == Item.CategoryID);
        }
    }
    void Submit()
    {
        if (SelectedCategory == null)
            return;
        if (Item.CategoryID == Guid.Empty)
        {
            Item.CategoryID = SelectedCategory.ID;
            Item.Category = SelectedCategory;
            Item.CreatedTimeStamp = DateTime.Now;
            trophyService.CreateItem(Item);
        }
        else
            trophyService.UpdateItem(Item);
        MudDialog.Close(DialogResult.Ok(Item));
    }
    void Cancel() => MudDialog.Close(DialogResult.Cancel());

    /*
        var options = new DialogOptions()
        {
            CloseOnEscapeKey = true,
            MaxWidth = MaxWidth.Medium
        };
        var parameters = new DialogParameters();
        parameters.Add(nameof(ConfirmDialog.Message), $"Delete the topic \"{topic.TopicName}\"?");
        parameters.Add(nameof(ConfirmDialog.ButtonText), "Yes, Delete");
        parameters.Add(nameof(ConfirmDialog.ButtonColor), Color.Error);
        var dialog = dialogService.ShowAsync<ConfirmDialog>("Confirm Delete?", parameters, options);
        var result = await dialog;
        var result2 = await result.Result;
        if (result2?.Canceled == false)
        {
            Topics.Remove(topic);
            testService.DeleteTopic(topic);
        }
    */
}

